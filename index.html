<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Optime Player</title>

    <style>
        @font-face {
            font-family: HindSiliguri;
            src: url("fonts/HindSiliguri-Regular.ttf");
        }

        body {
            font-family: HindSiliguri, sans-serif;

            text-align: center;
        }

        body.dark-mode {
            background-color: #222;
            color: #eee;
        }

        body.dark-mode a {
            color: #9cf;
        }

        body.dark-mode button {
            background-color: #444;
            color: #eee;
            border: 1px solid #666;
            border-radius: 5px;
        }

        body.dark-mode input[type="file"] {
            color: #eee;
            border-radius: 5px;
        }

        body.dark-mode select {
            background-color: #444;
            color: #eee;
            border: 1px solid #666;
            border-radius: 5px;
        }

        body.dark-mode .modal-content {
            background-color: #333;
            color: #eee;
            border: 1px solid #555;
        }

        #drop-zone {
            display: flex;
            align-items: center;
            justify-content: center;

            /* display: none; */

            background: gray;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            opacity: 0.8;

            font-size: 32px;

            visibility: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 0.8fr 1fr 0.8fr;
            grid-template-rows: 0.7fr 1.3fr 1fr;
            gap: 0 0;
            grid-template-areas:
                "song-picker . visualizer-pane"
                "song-picker . ."
                "song-picker . .";
        }

        .song-picker {
            grid-area: song-picker;

            display: flex;
            width: 100%;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }

        .song-block {
            position: relative;
            text-align: left;
            width: 100%;
            line-height: 0;
        }

        .song-button {
            margin: 0;
            width: 100%;
            text-align: left;
            margin-bottom: 5px;
            /* Added spacing */
        }

        .now-playing-icon {
            display: inline;
            position: absolute;
            pointer-events: none;
        }

        #visualizer-canvas {
            image-rendering: pixelated;
        }

        #visualizer-pane {
            columns: 1;

            display: none;
            position: sticky;
            /* TODO: make this proper later */
            top: 0;
        }

        #fullscreen-vis-canvas {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .button-group {
            margin-top: 4px;
            margin-bottom: 4px;
        }

        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        .settings-column {
            position: sticky;
            top: 0;
            height: fit-content;
        }

        #mobile-song-list-toggle,
        #mobile-song-list-close {
            display: none !important;
            /* Hide on desktop */
        }

        /* Mobile responsive styles */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
                grid-template-areas:
                    "."
                    "visualizer-pane"
                    "song-picker";
            }

            .settings-column {
                position: relative;
                top: auto;
            }

            #visualizer-canvas {
                max-width: 100%;
                height: auto;
            }

            button {
                min-height: 44px;
                padding: 12px;
            }

            input[type="range"] {
                min-height: 44px;
            }

            .song-picker {
                padding: 0 10px;
                display: none;
                /* Hide by default on mobile */
            }

            .song-picker.show {
                display: flex !important;
                flex-direction: column;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: rgba(30, 30, 30, 0.98);
                z-index: 10000;
                overflow-y: auto;
                padding: 20px 10px 80px 10px;
                /* Added large bottom padding */
                box-sizing: border-box;
            }

            #mobile-song-list-toggle {
                display: block !important;
                width: 100%;
                margin-bottom: 10px;
                background-color: #555;
                font-size: 16px;
            }

            #mobile-song-list-close.show {
                display: flex !important;
                position: fixed;
                top: 15px;
                right: 15px;
                width: 44px;
                height: 44px;
                background-color: #aa2222;
                color: white;
                border: none;
                border-radius: 50%;
                font-size: 28px;
                font-weight: bold;
                align-items: center;
                justify-content: center;
                z-index: 10001;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
                line-height: 1;
                padding: 0;
            }

            body {
                padding: 0;
                margin: 0;
            }
        }
    </style>

    <script src="OptimePlayer/dsp.js"></script>
    <script src="OptimePlayer/OptimePlayer.js"></script>
    <script src="index.js"></script>
</head>

<body class="dark-mode">
    <div id="drop-zone">
        <h1>Drop file!</h1>
    </div>
    <h1 style="margin-bottom: 0">Optime Player</h1>
    <a href="https://github.com/Nectarboy/OptimePlayer">https://github.com/Nectarboy/OptimePlayer</a>

    <div id="progress-modal" class="modal">
        <div class="modal-content">
            <label for="progress-bar">Rendering progress:</label>
            <progress id="progress-bar" value="0" max="100"></progress>
            <p id="progress-info"></p>
        </div>
    </div>

    <div class="container">
        <button id="mobile-song-list-close">&times;</button>
        <div class="song-picker"></div>

        <div class="settings-column">
            <div id="file-picker-container">
                <h3>Drag and drop a Nintendo DS ROM or an SDAT File</h3>
                <p>or</p>
                <input type="file" id="file-picker" accept=".nds, .sdat" />
            </div>
            <div id="demos">
                <h3>Demos</h3>
                <button onclick="loadDemo('new-super-mario-bros')">
                    New Super Mario Bros.
                </button>
                <button onclick="loadDemo('super-mario-64-ds')">
                    Super Mario 64 DS
                </button>
                <button onclick="loadDemo('pokemon-platinum')">
                    Pokémon Platinum
                </button>
                <button onclick="loadDemo('pokemon-heartgold')">
                    Pokémon HeartGold
                </button>
                <button onclick="loadDemo('pokemon-black-2')">
                    Pokémon Black 2
                </button>
                <button onclick="loadDemo('ace-attorney')">
                    Phoenix Wright: Ace Attorney
                </button>
                <button onclick="loadDemo('sound_data')">
                    Tomodachi Collection
                </button>
            </div>

            <div>
                <h3>Settings</h3>
                <input type="checkbox" id="stereo-separation" />
                <label for="stereo-separation">Stereo Separation</label><br />
                <input type="checkbox" id="force-stereo-separation" />
                <label for="force-stereo-separation">"Force" Stereo Separation (restart song to
                    apply)</label><br />
                <input type="checkbox" id="accurate-mixing" />
                <label for="accurate-mixing">Accurate Mixing (WIP)</label><br />
                <input type="checkbox" id="carry-over-redundant" />
                <label for="carry-over-redundant"
                    title="Some sequences expect data from previously played sequences. Enable if a sequence is missing sounds">Carry
                    over data from last sequence</label><br />
                <input type="checkbox" id="use-custom-seed" />
                <label for="use-custom-seed">Use fixed RNG Seed: </label>
                <input type="text" id="custom-seed" size="10" /><br /><br />

                <label for="master-volume">Master Volume:</label>
                <input type="range" id="master-volume" min="0" max="100" value="100" /><br /><br />

                <label for="tuning-system">Tuning System</label>

                <select name="tuning-systems" id="tuning-system">
                    <option value="equal null">Equal Temperament</option>
                    <option value="pure 0">Pure A</option>
                    <option value="pure 1">Pure A#</option>
                    <option value="pure 2">Pure B</option>
                    <option value="pure 3">Pure C</option>
                    <option value="pure 4">Pure C#</option>
                    <option value="pure 5">Pure D</option>
                    <option value="pure 6">Pure D#</option>
                    <option value="pure 7">Pure E</option>
                    <option value="pure 8">Pure F</option>
                    <option value="pure 9">Pure F#</option>
                    <option value="pure 10">Pure G</option>
                    <option value="pure 11">Pure G#</option>
                    <option value="accurate null"
                        title="The DS sound engine's tuning system results in higher notes being slightly pitched up">
                        Hardware Accurate
                    </option>
                </select>
            </div>

            <div>
                <h3>Track Volumes</h3>
                <div id="track-volume-sliders">
                    <label for="track-volume-0">Track 0:</label>
                    <input type="range" id="track-volume-0" min="0" max="100" value="100" /><br />
                    <label for="track-volume-1">Track 1:</label>
                    <input type="range" id="track-volume-1" min="0" max="100" value="100" /><br />
                    <label for="track-volume-2">Track 2:</label>
                    <input type="range" id="track-volume-2" min="0" max="100" value="100" /><br />
                    <label for="track-volume-3">Track 3:</label>
                    <input type="range" id="track-volume-3" min="0" max="100" value="100" /><br />
                    <label for="track-volume-4">Track 4:</label>
                    <input type="range" id="track-volume-4" min="0" max="100" value="100" /><br />
                    <label for="track-volume-5">Track 5:</label>
                    <input type="range" id="track-volume-5" min="0" max="100" value="100" /><br />
                    <label for="track-volume-6">Track 6:</label>
                    <input type="range" id="track-volume-6" min="0" max="100" value="100" /><br />
                    <label for="track-volume-7">Track 7:</label>
                    <input type="range" id="track-volume-7" min="0" max="100" value="100" /><br />
                    <label for="track-volume-8">Track 8:</label>
                    <input type="range" id="track-volume-8" min="0" max="100" value="100" /><br />
                    <label for="track-volume-9">Track 9:</label>
                    <input type="range" id="track-volume-9" min="0" max="100" value="100" /><br />
                    <label for="track-volume-10">Track 10:</label>
                    <input type="range" id="track-volume-10" min="0" max="100" value="100" /><br />
                    <label for="track-volume-11">Track 11:</label>
                    <input type="range" id="track-volume-11" min="0" max="100" value="100" /><br />
                    <label for="track-volume-12">Track 12:</label>
                    <input type="range" id="track-volume-12" min="0" max="100" value="100" /><br />
                    <label for="track-volume-13">Track 13:</label>
                    <input type="range" id="track-volume-13" min="0" max="100" value="100" /><br />
                    <label for="track-volume-14">Track 14:</label>
                    <input type="range" id="track-volume-14" min="0" max="100" value="100" /><br />
                    <label for="track-volume-15">Track 15:</label>
                    <input type="range" id="track-volume-15" min="0" max="100" value="100" /><br />
                </div>
            </div>
        </div>

        <div id="visualizer-pane">
            <button id="mobile-song-list-toggle">Show Song List</button>
            <div class="button-group">
                <button id="fullscreen-vis-button">
                    Open Fullscreen Visualizer
                </button>
            </div>
            <div class="button-group">
                <button id="download-playing-button">
                    Download Currently Playing Song
                </button>
            </div>
            <div class="button-group">
                <button id="pause-button">Pause Sequence Player</button>
                <button id="restart-sequence-button">
                    Restart Sequence
                </button>
            </div>
            <div>
                <canvas id="visualizer-canvas" width="400" height="1000"></canvas>
            </div>
        </div>
    </div>

    <canvas id="fullscreen-vis-canvas"></canvas>
</body>

</html>